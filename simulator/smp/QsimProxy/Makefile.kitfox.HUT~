CXX = mpic++
QSIM_ROOT = ${QSIM_PREFIX}
KITFOX_ROOT = ${KITFOX_PREFIX}
KITFOX_LIBS = -lmcpat -L${KITFOX_ROOT} -l3dice -L${KITFOX_ROOT}
MODELS_DIR = ../../../models
CPPFLAGS += -Wall -g -DSTATS -DLIBKITFOX=1 -DHUTDEBUG=1 -I$(KITFOX_ROOT) -I$(MODELS_DIR)/memory -I$(MODELS_DIR)/kitfox/proxy -std=c++11
LDFLAGS = -lKitFox -L$(KITFOX_ROOT) ${KITFOX_LIBS} -lkitfox_proxy -L$(MODELS_DIR)/kitfox/proxy  -lDRAMSim2 -L$(MODELS_DIR)/memory/DRAMSim2 -lDRAMSim2proper -L$(MODELS_DIR)/memory/DRAMSim2/DRAMSim2-2.2.2  -L../../../kernel -lmanifold -ldl -lrt

VPATH = ../common

EXECS = smp_hmc_unit 


ALL: $(EXECS)


smp_hmc_unit: smp_hmc_unit.o sysBuilder_llp_HUT.o mc_builder.o kitfox_builder.o hmc_xbar.o
	$(CXX) $^ -o$@  $(LDFLAGS) -lconfig++

%.o: %.cc
	@[ -d dep ] || mkdir -p dep
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -MMD -MF dep/$*.d -c $< -o $*.o

-include $(wildcard dep/*.d)

.PHONY: clean
clean:
	rm -f $(EXECS) *.d *.o DBG* core*.out
	rm -rf dep

